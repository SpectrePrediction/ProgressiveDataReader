# ProgressiveDataReader
 Universal data reader, which is a partition of my other projects, can meet the data reading under low memory</br>
 é€šç”¨æ•°æ®è¯»å–å™¨ï¼Œä»–æ˜¯æˆ‘å…¶ä»–é¡¹ç›®çš„åˆ†å‰²ï¼Œèƒ½å¤Ÿæ»¡è¶³ä½å†…å­˜ä¸‹çš„æ•°æ®è¯»å–</br>

## â›³ä¾èµ–
å‡ ä¹æ²¡æœ‰</br>
### å…¶ä¸­</br>
numpy ä»¥åŠ opencvæ˜¯å…³äºæ•°æ®è¯»å–å’Œå¤„ç†çš„éƒ¨åˆ†ï¼Œä½ å¯ä»¥è‡ªå®šä¹‰è‡ªå·±éœ€è¦è¯»å–æ–¹å¼
***
## ğŸ”¨ä½¿ç”¨æ–¹æ³•
å…¨éƒ¨éƒ½åœ¨[DateReader.py](./DateReader.py)ä¸­</br>

### å…¶æœ€ä¸»è¦çš„æ˜¯ï¼š</br>
```python
class DataReader (...)

dr = DataReader(r"test.txt", [
        img_padding,  # img_paddingæ²¡ä½¿ç”¨ä¿®é¥°ï¼Œæ‰€ä»¥ä¼ å…¥å‡½æ•°åï¼Œå¦‚æœä½¿ç”¨ä¿®é¥°æ­¤å¤„ä½¿ç”¨img_padding()
        img_resize((512, 512)),
        img_BGR2YUV(),
    ],
    read_data_func=one_hot_label_read_func(3),  # 3ç±»ç±»åˆ«
    read_data_cache=20,  # è¯»å–æ•°æ®çš„ç¼“å†²å¤§å°
    batch_size=10,  # è¯»å–æ•°æ®å¾—åˆ°çš„æ‰¹å¤§å° å¿…å¡«
    is_completion=True,  # æ˜¯å¦å¡«å……
    using_thread_num=5,  # ä½¿ç”¨çº¿ç¨‹æ•°
    is_show_progress=True  # æ˜¯å¦å¯è§†åŒ–è¯»å–è¿›ç¨‹
    # read_txt_func  # è¯»å–æ–‡æœ¬çš„å‡½æ•° ä½¿ç”¨é»˜è®¤
    # is_shuffle  # æ˜¯å¦ä¹±åº ä½¿ç”¨é»˜è®¤
)

for epoch, image, label in dr:
    image = np.array(image).astype("float32") / 255.0
    label = np.array(label)

    print(image.shape, label.shape, epoch)

```

### å¯ä»¥æ³¨æ„åˆ°å‡ ä¸ªè¦ç‚¹
- DataReaderç±»é€šè¿‡è¯»å–txtä¸­å­˜æ”¾çš„æ•°æ®åœ°å€å†è¿›è¡Œæ•°æ®åŠ è½½
- - è¿™æ„å‘³ç€ä½ å¯ä»¥å®šä¹‰è‡ªå·±çš„æ–‡æœ¬æ–‡ä»¶è¯»å–æ–¹æ³•ä»¥åŠæ•°æ®è¯»å–æ–¹æ³•
- - ä¾‹å¦‚è¯»å–å¤šä¸ªå›¾ç‰‡è€Œéè¯»å–å›¾ç‰‡åŠ æ ‡ç­¾ï¼ˆé»˜è®¤è¯»å–æ–¹æ³•å°±æ˜¯å¦‚æ­¤ï¼‰
- DataReaderç±»æœ‰ä¸ªä¸“é—¨çš„åˆ—è¡¨ç”¨äºå­˜æ”¾ç»™æ•°æ®é¢„å¤„ç†çš„å‡½æ•°ï¼Œæˆ–è€…ä½ å¯ä»¥å°†è¿™éƒ¨åˆ†æ”¾åœ¨æ•°æ®è¯»å–çš„å®šä¹‰ä¸­
- - ä½ å¯ä»¥è‡ªå®šä¹‰è¿™äº›é¢„å¤„ç†å‡½æ•°ï¼Œå‰ææ˜¯ä½ éœ€è¦éµå®ˆä¸€å®šçš„çº¦å®š
- DataReaderç±»å…è®¸è®¾å®šè¯»å–ç¼“å†²read_data_cacheï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨æ—¶æ¸è¿›å¼åŠ è½½ä¸‹ä¸€æ‰¹çš„æ•°æ®
- - è¿™å¯ä»¥åœ¨å†…å­˜å®¹é‡æ— æ³•ä¸€æ¬¡æ€§å…¨éƒ¨åŠ è½½æ•°æ®é›†æ—¶èµ·åˆ°ä½œç”¨
- DataReaderç±»å…è®¸è®¾ç½®çº¿ç¨‹æ•°ã€å¡«å……ã€å¯è§†åŒ–ã€ä¹±åºç­‰åŸºæœ¬åŠŸèƒ½
***
- äº‹å®ä¸Šä½¿ç”¨çš„one_hot_label_read_funcå‡½æ•°æ˜¯è¢«ä¿®é¥°çš„é¢„å…ˆå®šä¹‰å¥½çš„æ•°æ®è¯»å–æ–¹æ³•
```python
@data_read_function(DEBUG)
def one_hot_label_read_func(img_path, label_class):
    if '.' in img_path:
        return cv2.imread(img_path)

    return one_hot(img_path, label_class)
```
- è¿™éå¸¸çš„ç®€é™‹ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªå¥½ä¾‹å­ï¼Œä½ å¯ä»¥åœ¨å…¶ä»–åœ°æ–¹å‘ç°è®¸å¤šå‡½æ•°è°ƒç”¨ä¾‹å¦‚ï¼š
```python
    img_resize((512, 512))
    img_BGR2YUV()
 ```
- - ä»¥åŠåŒä¸€åœ°æ–¹å´ä¼ å…¥å‡½æ•°åçš„ï¼š
```python
    img_padding
 ```
### ä»–ä»¬ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä½¿ç”¨data_read_functionä¿®é¥°ï¼</br>
ä¸ºä½¿ç”¨data_read_functionä¿®é¥°ï¼š
- [ ] ä¼ å…¥å‡½æ•°åç”¨ä»¥è¢«è°ƒç”¨
- [ ] æ— æ³•å®šä¹‰é¢å¤–å‚æ•°æˆ–è€…å‚æ•°æ— æ³•ä¼ å…¥
- [ ] ä¸€äº›å¸¸é‡åªèƒ½å†™æ­»åœ¨å‡½æ•°å†…éå¸¸ä¸ä¾¿</br>
ä¸ºæ­¤è€Œå®ç°çš„data_read_functionä¿®é¥°ï¼Œèƒ½å¤Ÿå®ç°ï¼š</br>
- [x] ä¿®é¥°åçš„å‡½æ•°æ— éœ€æ›´æ”¹å†™æ³•ï¼Œå…è®¸ç±»ä¼¼é—­åŒ…çš„æ•ˆæœ
- [x] ä¿®é¥°åçš„å‡½æ•°å¯ä»¥æå‰å‡½æ•°è°ƒç”¨ä¼ å…¥è‡ªå®šä¹‰çš„å‚æ•°
- [x] ä¿®é¥°åçš„å‡½æ•°ä½¿ç”¨èµ·æ¥ä¸æ­£å¸¸å‡½æ•°æ²¡æœ‰åŒºåˆ«
- [x] data_read_functionå…è®¸ä¼ å…¥å‚æ•°æ¥æ§åˆ¶æ˜¯å¦å¯åŠ¨
```python
çœ‹çœ‹ä¸Šé¢æˆ‘ä»¬è¢«ä¿®é¥°çš„å‡½æ•°one_hot_label_read_func

ä»–çš„å®šä¹‰å½¢å¼æ˜¯one_hot_label_read_funcï¼ˆimg_path, label_classï¼‰
æ­£å¸¸çš„è°ƒç”¨æ–¹å¼æ˜¯one_hot_label_read_func("test.jpg", 3)
è¢«ä¿®é¥°åçš„è°ƒç”¨æ–¹å¼one_hot_label_read_func(3)("test.jpg")
ä»–ä»¬æ˜¯ç­‰æ•ˆæœçš„

data_read_functionå¯¹å¤šä½™å‚æ•°çš„æ•°é‡æ²¡æœ‰è¦æ±‚ï¼ˆimg_path, label_class1ï¼Œ label_class2, ...ï¼‰
one_hot_label_read_func(img_path, label_class1ï¼Œ label_class2, ...)
ä¿®é¥°å
one_hot_label_read_func(label_class1ï¼Œ label_class2, ...)ï¼ˆimg_pathï¼‰
```
### é™¤å»è¿™ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„éƒ¨åˆ†ï¼Œå‰©ä¸‹çš„é”¦ä¸Šæ·»èŠ±
- log_print å¸¦é¢œè‰²çš„æ‰“å°æ•ˆæœ
- CacheList ä¸€ä¸ªå¸¦æœ‰é˜Ÿåˆ—ç±»ä¼¼æ•ˆæœçš„åˆ—è¡¨ï¼ˆåˆ°è¾¾æ•°é‡åæœ€å…ˆè¿›å…¥çš„è¢«åˆ é™¤ï¼‰
- one_hotã€one_hot_by_container ä¸€çƒ­ç¼–ç çš„å·¥å…·
- label_read_funcã€one_hot_label_read_func é¢„å®šä¹‰çš„æ•°æ®è¯»å–æ–¹æ³•
- img_random_resize_from_dictã€img_float_normalizationç­‰ä¸€äº›åˆ—é¢„å¤„ç†æ–¹æ³•

### æ­¤è¯»å–è€…ä¸ºé¡¹ç›®ä¸­å¼€å‘çš„é™„å±å“ï¼Œæ‰€ä»¥æœ‰äº›åœ°æ–¹è¿˜æ˜¯æœ‰ç€è®¸å¤šä¸è¶³
å°†å…¶å¼€æºä¹Ÿæ­£æ˜¯ä¸ºäº†å®Œå–„å®ƒå¹¶ä¸”æ–¹ä¾¿è‡ªå·±ä¸‹è½½ğŸŒ¹
